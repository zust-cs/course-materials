# 什么是Jenkins

1）Jenkins是一个开源持续集成工具。

2）开发工具：JAVA。

3）功能：提供了软件开发的持续集成服务。

4）特点：支持主流软件配置管理，配合实现软件配置管理，持续集成功能。

# Jenkins的优势和应用场景

1）主流的运维开发平台，兼容所有主流开发环境。

2）插件市场可与海量业内主流开发工具实现集成。

3）Job为配置单位与日志管理，使运维与开发人员能协同工作。

4）权限管理划分不同Job不同角色。

5）强大的负载均衡功能，保证我们项目的可靠性。

# Jenkins Job介绍

1）代表一个任务或者项目。

2）可配置与可执行。

3）执行后的记录称之为Build。

4）日志监控与记录。

5）所有文件集中保存。

### Freestyle Job：

1）需在页面添加模块配置项与参数完成配置。

2）每个Job仅能实现一个开发功能。

3）无法将配置代码化，不利于Job配置迁移与版本控制。

4）逻辑相对简单，无需额外学习成本。

### Pipeline Job：

匹配持续集成（CI）与持续交付（CD）的几个核心概念。

**持续：**“持续”用于描述遵循许多不同流程时间。这并不意味着“一直在运行”，而是“随时可运行”。

**快速失败：**管道的工作之一就是快速处理变更。另一个是监视创建发布的不同任务和作业。由于编译失败或测试未通过的代码可以阻止管道继续运行，因此快速通知用户此类情况非常重要。快速失败指的是在管道流程中尽快发现问题并快速通知用户的方式，这样可以及时修正问题并重新提交代码以便管道在此运行。通常在管道流程中可通过查看历史记录来确定是谁做了那次修改并通知此人及团队。

**持续集成：**持续集成（CI）是在源代码变更后自动检测、拉去、构建和进行单元测试的过程。持续集成是启动管道的环节。检测变更的工作通常由Jenkins负责。检测的类型有：

​	1）轮询：检测程序反复询问代码管理系统是否有新变更。

​	2）定期：检测程序配置为定期启动构建，无论代码是否有变更，但若没有变更，也不会增加额外成本。

​	3）推送：这与用于代码管理系统检查的检测程序相反，代码管理系统被配置为提交变更到仓库时将“推送”
一个通知到检测程序。

**单元测试：**单元测试是由开发人员编写的小型的专项测试，以确保新代码独立工作。所谓的独立是指不依赖或调用其他不可直接访问的代码，也不依赖外部数据或其他模块，如果必要的话可以用模拟（mock）表示。常见的单元测试框架有Java开发的JUnit。

**持续交付：**持续交付（CD）通常是指整个流程链（管道），它自动检测源代码变更并通过构建、测试、打包和相关操作运行它们以生成可部署的版本，基本上没有任何人为干预。

#### 特点：

1）所有模块，参数配置都可以体现为一个pipeline脚本。

2）可以定义多个stage构建一个管道工作集。

3）所有配置代码化，方便Job配置迁移与版本控制。

4）需要pipeline脚本语法基础。

#### 编写规范：

**基础架构：**

1）所有代码包裹在pipeline{}层内。

2）stages{}层用来包含该pipeline所有stage子层。

3）stage{}层用来包含具体我们需要编写任务的steps{}子层。

4）steps{}层用来添加我们具体需要调用的模块语句。
**agent区域：**

1）agent定义pipeline在哪里运行。

​      可以使用any，none，或具体的Jenkins node主机名等。

​	  例如要特指在node1上执行，可以写成`agent {node{label 'node1'}}`

**environment区域：**

1）”变量名称=变量值“定义我们的环境变量。

2）可以定义全局环境变量，应用所有stages任务。

3）可以定义stage环境变量，应用单独的stage任务。

**script区域（可选）：**

1）在steps内定义script{}。

2）groovy脚本语言。

3）用来进行脚本逻辑运算。

**常用steps区域：**

1）echo：打印输出。

2）sh：调用Linux系统shell命令。

3）git url：调用git模块进行git相关操作。

```
pipeline{
	agent any
	environment{
		host='test.example.com'
		user='deploy'
	}
	stages{
		stage('build'){
			steps{
				sh "cat $host"
				echo $deploy
				script{
					def servers = ['node1','node2']
					For(int i=0;i<server.size();i++){
						echo "testing ${servers[i]} server"
					}
				}
			}
		}
	}
}
```



